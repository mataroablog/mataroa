From: theo@torchandzen.com
To: 0237b3eb0fe3fd3062bb706d9a087409@inbound.postmarkapp.com
Subject: Fwd: [Mataroa Notification] ERROR (EXTERNAL IP): Internal Server Error: /billing/subscription/cancel/



On Sat, 6 Dec 2025, at 13:44, Mataroa Server wrote:
> Internal Server Error: /billing/subscription/cancel/
>
> AttributeError at /billing/subscription/cancel/
> 'AnonymousUser' object has no attribute 'is_grandfathered'
>
> Request Method: GET
> Request URL: https://mataroa.blog/billing/subscription/cancel/
> Django Version: 6.0rc1
> Python Executable: /var/www/mataroa/.venv/bin/python
> Python Version: 3.13.5
> Python Path: ['/var/www/mataroa', '/var/www/mataroa/.venv/bin', 
> '/usr/lib/python313.zip', '/usr/lib/python3.13', 
> '/usr/lib/python3.13/lib-dynload', 
> '/var/www/mataroa/.venv/lib/python3.13/site-packages']
> Server time: Sat, 06 Dec 2025 13:44:10 +0000
> Installed Applications:
> ['main.apps.MainConfig',
>  'django.contrib.admin',
>  'django.contrib.auth',
>  'django.contrib.contenttypes',
>  'django.contrib.sessions',
>  'django.contrib.messages',
>  'django.contrib.staticfiles',
>  'django.contrib.sitemaps',
>  'django.contrib.humanize']
> Installed Middleware:
> ['main.middleware.speed_middleware',
>  'django.middleware.security.SecurityMiddleware',
>  'django.contrib.sessions.middleware.SessionMiddleware',
>  'django.middleware.common.CommonMiddleware',
>  'django.middleware.csrf.CsrfViewMiddleware',
>  'django.contrib.auth.middleware.AuthenticationMiddleware',
>  'django.contrib.messages.middleware.MessageMiddleware',
>  'django.middleware.clickjacking.XFrameOptionsMiddleware',
>  'main.middleware.host_middleware']
>
>
> Traceback (most recent call last):
>   File 
> "/var/www/mataroa/.venv/lib/python3.13/site-packages/django/core/handlers/exception.py", 
> line 55, in inner
>     response = get_response(request)
>                ^^^^^^^^^^^^^^^^^^^^^
>   File 
> "/var/www/mataroa/.venv/lib/python3.13/site-packages/django/core/handlers/base.py", 
> line 198, in _get_response
>     response = wrapped_callback(request, *callback_args, 
> **callback_kwargs)
>                
> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>   File 
> "/var/www/mataroa/.venv/lib/python3.13/site-packages/django/views/generic/base.py", 
> line 106, in view
>     return self.dispatch(request, *args, **kwargs)
>            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>   File "/var/www/mataroa/main/views/billing.py", line 464, in dispatch
>     if request.user.is_grandfathered:
>        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>   File 
> "/var/www/mataroa/.venv/lib/python3.13/site-packages/django/utils/functional.py", 
> line 253, in inner
>     return func(_wrapped, *args)
>            ^^^^^^^^^^^^^^^^^^^^^
>
> Exception Type: AttributeError at /billing/subscription/cancel/
> Exception Value: 'AnonymousUser' object has no attribute 'is_grandfathered'
> Raised during: main.views.billing.BillingCancel
> Request information:
> USER: AnonymousUser
>
> GET: No GET data
>
> POST: No POST data
>
> FILES: No FILES data
>
> COOKIES: No cookie data
>
> META:
> HTTP_ACCEPT = '*/*'
> HTTP_ACCEPT_ENCODING = 'gzip, deflate, br, zstd'
> HTTP_ACCEPT_LANGUAGE = 'en-GB,en-US;q=0.9,en;q=0.8'
> HTTP_CACHE_CONTROL = 'max-age=0'
> HTTP_EARLY_DATA = '1'
> HTTP_HOST = 'mataroa.blog'
> HTTP_PRIORITY = 'u=1, i'
> HTTP_SEC_CH_UA = '"Brave";v="143", "Chromium";v="143", "Not 
> A(Brand";v="24"'
> HTTP_SEC_CH_UA_MOBILE = '?0'
> HTTP_SEC_CH_UA_PLATFORM = '"macOS"'
> HTTP_SEC_FETCH_DEST = 'empty'
> HTTP_SEC_FETCH_MODE = 'cors'
> HTTP_SEC_FETCH_SITE = 'none'
> HTTP_SEC_GPC = '1'
> HTTP_USER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) 
> AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36'
> HTTP_VIA = '3.0 Caddy'
> HTTP_X_FORWARDED_FOR = '150.107.93.72'
> HTTP_X_FORWARDED_HOST = 'mataroa.blog'
> HTTP_X_FORWARDED_PROTO = 'https'
> PATH_INFO = '/billing/subscription/cancel/'
> QUERY_STRING = ''
> RAW_URI = '/billing/subscription/cancel/'
> REMOTE_ADDR = '127.0.0.1'
> REMOTE_PORT = '44404'
> REQUEST_METHOD = 'GET'
> SCRIPT_NAME = ''
> SERVER_NAME = '127.0.0.1'
> SERVER_PORT = '5000'
> SERVER_PROTOCOL = 'HTTP/1.1'
> SERVER_SOFTWARE = 'gunicorn/23.0.0'
> gunicorn.socket = <socket.socket fd=8, family=2, type=1, proto=0, 
> laddr=('127.0.0.1', 5000), raddr=('127.0.0.1', 44404)>
> wsgi.errors = <gunicorn.http.wsgi.WSGIErrorsWrapper object at 
> 0x7fc153688a30>
> wsgi.file_wrapper = <class 'gunicorn.http.wsgi.FileWrapper'>
> wsgi.input = <gunicorn.http.body.Body object at 0x7fc1512ec7d0>
> wsgi.input_terminated = True
> wsgi.multiprocess = True
> wsgi.multithread = False
> wsgi.run_once = False
> wsgi.url_scheme = 'https'
> wsgi.version = '(1, 0)'
>
> Settings:
> Using settings module mataroa.settings
> ABSOLUTE_URL_OVERRIDES = {}
> ADMINS = ['theo+buenosayres@torchandzen.com']
> ALLOWED_HOSTS = ['127.0.0.1', 'localhost', '.mataroa.blog', 
> '.mataroalocal.blog', '*']
> APPEND_SLASH = True
> AUTHENTICATION_BACKENDS = '********************'
> AUTH_PASSWORD_VALIDATORS = '********************'
> AUTH_USER_MODEL = '********************'
> BASE_DIR = PosixPath('/var/www/mataroa')
> CACHES = {'default': {'BACKEND': 
> 'django.core.cache.backends.locmem.LocMemCache'}}
> CACHE_MIDDLEWARE_ALIAS = 'default'
> CACHE_MIDDLEWARE_KEY_PREFIX = '********************'
> CACHE_MIDDLEWARE_SECONDS = 600
> CANONICAL_HOST = 'mataroa.blog'
> CSRF_COOKIE_AGE = 31449600
> CSRF_COOKIE_DOMAIN = None
> CSRF_COOKIE_HTTPONLY = False
> CSRF_COOKIE_NAME = 'csrftoken'
> CSRF_COOKIE_PATH = '/'
> CSRF_COOKIE_SAMESITE = 'Lax'
> CSRF_COOKIE_SECURE = True
> CSRF_FAILURE_VIEW = 'django.views.csrf.csrf_failure'
> CSRF_HEADER_NAME = 'HTTP_X_CSRFTOKEN'
> CSRF_TRUSTED_ORIGINS = []
> CSRF_USE_SESSIONS = False
> CUSTOM_DOMAIN_IP = '95.217.30.133'
> DATABASES = {'default': {'ENGINE': 'django.db.backends.postgresql', 
> 'NAME': 'mataroa', 'USER': 'mataroa', 'PASSWORD': 
> '********************', 'HOST': 'localhost', 'PORT': 5432, 
> 'CONN_MAX_AGE': 500, 'ATOMIC_REQUESTS': False, 'AUTOCOMMIT': True, 
> 'CONN_HEALTH_CHECKS': False, 'OPTIONS': {}, 'TIME_ZONE': None, 'TEST': 
> {'CHARSET': None, 'COLLATION': None, 'MIGRATE': True, 'MIRROR': None, 
> 'NAME': None}}}
> DATABASE_ROUTERS = []
> DATA_UPLOAD_MAX_MEMORY_SIZE = 2621440
> DATA_UPLOAD_MAX_NUMBER_FIELDS = 1000
> DATA_UPLOAD_MAX_NUMBER_FILES = 100
> DATETIME_FORMAT = 'F j, Y, P'
> DATETIME_INPUT_FORMATS = ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S.%f', 
> '%Y-%m-%d %H:%M', '%m/%d/%Y %H:%M:%S', '%m/%d/%Y %H:%M:%S.%f', 
> '%m/%d/%Y %H:%M', '%m/%d/%y %H:%M:%S', '%m/%d/%y %H:%M:%S.%f', 
> '%m/%d/%y %H:%M']
> DATE_FORMAT = 'F j, Y'
> DATE_INPUT_FORMATS = ['%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y', '%b %d %Y', 
> '%b %d, %Y', '%d %b %Y', '%d %b, %Y', '%B %d %Y', '%B %d, %Y', '%d %B 
> %Y', '%d %B, %Y']
> DEBUG = False
> DEBUG_PROPAGATE_EXCEPTIONS = False
> DECIMAL_SEPARATOR = '.'
> DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
> DEFAULT_CHARSET = 'utf-8'
> DEFAULT_EXCEPTION_REPORTER = 'django.views.debug.ExceptionReporter'
> DEFAULT_EXCEPTION_REPORTER_FILTER = 
> 'django.views.debug.SafeExceptionReporterFilter'
> DEFAULT_FROM_EMAIL = 'Mataroa <admin@mataroa.blog>'
> DEFAULT_INDEX_TABLESPACE = ''
> DEFAULT_TABLESPACE = ''
> DISALLOWED_USER_AGENTS = []
> EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
> EMAIL_FROM_HOST = 'mataroa.blog'
> EMAIL_HOST = 'smtp.postmarkapp.com'
> EMAIL_HOST_BROADCASTS = 'smtp-broadcasts.postmarkapp.com'
> EMAIL_HOST_PASSWORD = '********************'
> EMAIL_HOST_USER = '0bd61576-2585-423e-a92c-4e6b2335c07e'
> EMAIL_PORT = 587
> EMAIL_SSL_CERTFILE = None
> EMAIL_SSL_KEYFILE = '********************'
> EMAIL_SUBJECT_PREFIX = '[Mataroa Notification] '
> EMAIL_TIMEOUT = None
> EMAIL_USE_LOCALTIME = False
> EMAIL_USE_SSL = False
> EMAIL_USE_TLS = True
> FILE_UPLOAD_DIRECTORY_PERMISSIONS = None
> FILE_UPLOAD_HANDLERS = 
> ['django.core.files.uploadhandler.MemoryFileUploadHandler', 
> 'django.core.files.uploadhandler.TemporaryFileUploadHandler']
> FILE_UPLOAD_MAX_MEMORY_SIZE = 2621440
> FILE_UPLOAD_PERMISSIONS = 420
> FILE_UPLOAD_TEMP_DIR = None
> FIRST_DAY_OF_WEEK = 0
> FIXTURE_DIRS = []
> FORCE_SCRIPT_NAME = None
> FORMAT_MODULE_PATH = None
> FORMS_URLFIELD_ASSUME_HTTPS = True
> FORM_RENDERER = 'django.forms.renderers.DjangoTemplates'
> IGNORABLE_404_URLS = []
> INSTALLED_APPS = ['main.apps.MainConfig', 'django.contrib.admin', 
> 'django.contrib.auth', 'django.contrib.contenttypes', 
> 'django.contrib.sessions', 'django.contrib.messages', 
> 'django.contrib.staticfiles', 'django.contrib.sitemaps', 
> 'django.contrib.humanize']
> INTERNAL_IPS = []
> LANGUAGES = [('af', 'Afrikaans'), ('ar', 'Arabic'), ('ar-dz', 'Algerian 
> Arabic'), ('ast', 'Asturian'), ('az', 'Azerbaijani'), ('bg', 
> 'Bulgarian'), ('be', 'Belarusian'), ('bn', 'Bengali'), ('br', 
> 'Breton'), ('bs', 'Bosnian'), ('ca', 'Catalan'), ('ckb', 'Central 
> Kurdish (Sorani)'), ('cs', 'Czech'), ('cy', 'Welsh'), ('da', 'Danish'), 
> ('de', 'German'), ('dsb', 'Lower Sorbian'), ('el', 'Greek'), ('en', 
> 'English'), ('en-au', 'Australian English'), ('en-gb', 'British 
> English'), ('eo', 'Esperanto'), ('es', 'Spanish'), ('es-ar', 
> 'Argentinian Spanish'), ('es-co', 'Colombian Spanish'), ('es-mx', 
> 'Mexican Spanish'), ('es-ni', 'Nicaraguan Spanish'), ('es-ve', 
> 'Venezuelan Spanish'), ('et', 'Estonian'), ('eu', 'Basque'), ('fa', 
> 'Persian'), ('fi', 'Finnish'), ('fr', 'French'), ('fy', 'Frisian'), 
> ('ga', 'Irish'), ('gd', 'Scottish Gaelic'), ('gl', 'Galician'), ('he', 
> 'Hebrew'), ('hi', 'Hindi'), ('hr', 'Croatian'), ('hsb', 'Upper 
> Sorbian'), ('ht', 'Haitian Creole'), ('hu', 'Hungarian'), ('hy', 
> 'Armenian'), ('ia', 'Interlingua'), ('id', 'Indonesian'), ('ig', 
> 'Igbo'), ('io', 'Ido'), ('is', 'Icelandic'), ('it', 'Italian'), ('ja', 
> 'Japanese'), ('ka', 'Georgian'), ('kab', 'Kabyle'), ('kk', 'Kazakh'), 
> ('km', 'Khmer'), ('kn', 'Kannada'), ('ko', 'Korean'), ('ky', 'Kyrgyz'), 
> ('lb', 'Luxembourgish'), ('lt', 'Lithuanian'), ('lv', 'Latvian'), 
> ('mk', 'Macedonian'), ('ml', 'Malayalam'), ('mn', 'Mongolian'), ('mr', 
> 'Marathi'), ('ms', 'Malay'), ('my', 'Burmese'), ('nb', 'Norwegian 
> BokmÃ¥l'), ('ne', 'Nepali'), ('nl', 'Dutch'), ('nn', 'Norwegian 
> Nynorsk'), ('os', 'Ossetic'), ('pa', 'Punjabi'), ('pl', 'Polish'), 
> ('pt', 'Portuguese'), ('pt-br', 'Brazilian Portuguese'), ('ro', 
> 'Romanian'), ('ru', 'Russian'), ('sk', 'Slovak'), ('sl', 'Slovenian'), 
> ('sq', 'Albanian'), ('sr', 'Serbian'), ('sr-latn', 'Serbian Latin'), 
> ('sv', 'Swedish'), ('sw', 'Swahili'), ('ta', 'Tamil'), ('te', 
> 'Telugu'), ('tg', 'Tajik'), ('th', 'Thai'), ('tk', 'Turkmen'), ('tr', 
> 'Turkish'), ('tt', 'Tatar'), ('udm', 'Udmurt'), ('ug', 'Uyghur'), 
> ('uk', 'Ukrainian'), ('ur', 'Urdu'), ('uz', 'Uzbek'), ('vi', 
> 'Vietnamese'), ('zh-hans', 'Simplified Chinese'), ('zh-hant', 
> 'Traditional Chinese')]
> LANGUAGES_BIDI = ['he', 'ar', 'ar-dz', 'ckb', 'fa', 'ug', 'ur']
> LANGUAGE_CODE = 'en-us'
> LANGUAGE_COOKIE_AGE = None
> LANGUAGE_COOKIE_DOMAIN = None
> LANGUAGE_COOKIE_HTTPONLY = False
> LANGUAGE_COOKIE_NAME = 'django_language'
> LANGUAGE_COOKIE_PATH = '/'
> LANGUAGE_COOKIE_SAMESITE = None
> LANGUAGE_COOKIE_SECURE = False
> LOCALDEV = False
> LOCALE_PATHS = []
> LOGGING = {'version': 1, 'disable_existing_loggers': False, 'filters': 
> {'require_debug_false': {'()': 'django.utils.log.RequireDebugFalse'}, 
> 'require_debug_true': {'()': 'django.utils.log.RequireDebugTrue'}}, 
> 'formatters': {'django.server': {'()': 
> 'django.utils.log.ServerFormatter', 'format': '[{server_time}] 
> {message}', 'style': '{'}}, 'handlers': {'console': {'level': 'INFO', 
> 'filters': ['require_debug_true'], 'class': 'logging.StreamHandler'}, 
> 'django.server': {'level': 'INFO', 'class': 'logging.StreamHandler', 
> 'formatter': 'django.server'}, 'mail_admins': {'level': 'ERROR', 
> 'filters': ['require_debug_false'], 'class': 
> 'django.utils.log.AdminEmailHandler'}}, 'loggers': {'django': 
> {'handlers': ['console', 'mail_admins'], 'level': 'INFO'}, 
> 'django.server': {'handlers': ['django.server'], 'level': 'INFO', 
> 'propagate': False}, 'django.security.DisallowedHost': {'handlers': 
> ['console'], 'propagate': False}, 'main': {'handlers': ['console'], 
> 'level': 'INFO', 'propagate': False}}}
> LOGGING_CONFIG = 'logging.config.dictConfig'
> LOGIN_REDIRECT_URL = 'index'
> LOGIN_URL = '/accounts/login/'
> LOGOUT_REDIRECT_URL = 'index'
> MANAGERS = []
> MEDIA_ROOT = ''
> MEDIA_URL = '/'
> MESSAGE_STORAGE = 
> 'django.contrib.messages.storage.fallback.FallbackStorage'
> MIDDLEWARE = ['main.middleware.speed_middleware', 
> 'django.middleware.security.SecurityMiddleware', 
> 'django.contrib.sessions.middleware.SessionMiddleware', 
> 'django.middleware.common.CommonMiddleware', 
> 'django.middleware.csrf.CsrfViewMiddleware', 
> 'django.contrib.auth.middleware.AuthenticationMiddleware', 
> 'django.contrib.messages.middleware.MessageMiddleware', 
> 'django.middleware.clickjacking.XFrameOptionsMiddleware', 
> 'main.middleware.host_middleware']
> MIGRATION_MODULES = {}
> MONTH_DAY_FORMAT = 'F j'
> NOTIFICATIONS_FROM_EMAIL = 'Mataroa Notifications 
> <notifications@mataroa.blog>'
> NUMBER_GROUPING = 0
> PASSWORD_HASHERS = '********************'
> PASSWORD_RESET_TIMEOUT = '********************'
> PREPEND_WWW = False
> ROOT_URLCONF = 'mataroa.urls'
> SECRET_KEY = '********************'
> SECRET_KEY_FALLBACKS = '********************'
> SECURE_CONTENT_TYPE_NOSNIFF = True
> SECURE_CROSS_ORIGIN_OPENER_POLICY = 'same-origin'
> SECURE_CSP = {}
> SECURE_CSP_REPORT_ONLY = {}
> SECURE_HSTS_INCLUDE_SUBDOMAINS = False
> SECURE_HSTS_PRELOAD = False
> SECURE_HSTS_SECONDS = 0
> SECURE_PROXY_SSL_HEADER = None
> SECURE_REDIRECT_EXEMPT = []
> SECURE_REFERRER_POLICY = 'same-origin'
> SECURE_SSL_HOST = None
> SECURE_SSL_REDIRECT = False
> SERVER_EMAIL = 'Mataroa Server <server@mataroa.blog>'
> SESSION_CACHE_ALIAS = 'default'
> SESSION_COOKIE_AGE = 31449600
> SESSION_COOKIE_DOMAIN = 'mataroa.blog'
> SESSION_COOKIE_HTTPONLY = True
> SESSION_COOKIE_NAME = 'sessionid'
> SESSION_COOKIE_PATH = '/'
> SESSION_COOKIE_SAMESITE = 'Lax'
> SESSION_COOKIE_SECURE = True
> SESSION_ENGINE = 'django.contrib.sessions.backends.db'
> SESSION_EXPIRE_AT_BROWSER_CLOSE = False
> SESSION_FILE_PATH = None
> SESSION_SAVE_EVERY_REQUEST = False
> SESSION_SERIALIZER = 
> 'django.contrib.sessions.serializers.JSONSerializer'
> SETTINGS_MODULE = 'mataroa.settings'
> SHORT_DATETIME_FORMAT = 'm/d/Y P'
> SHORT_DATE_FORMAT = 'm/d/Y'
> SIGNING_BACKEND = 'django.core.signing.TimestampSigner'
> SILENCED_SYSTEM_CHECKS = []
> STATICFILES_DIRS = []
> STATICFILES_FINDERS = 
> ['django.contrib.staticfiles.finders.FileSystemFinder', 
> 'django.contrib.staticfiles.finders.AppDirectoriesFinder']
> STATIC_ROOT = PosixPath('/var/www/mataroa/static')
> STATIC_URL = '/static/'
> STORAGES = {'default': {'BACKEND': 
> 'django.core.files.storage.FileSystemStorage'}, 'staticfiles': 
> {'BACKEND': 
> 'django.contrib.staticfiles.storage.ManifestStaticFilesStorage'}}
> STRIPE_API_KEY = '********************'
> STRIPE_PRICE_ID = 'price_1IogIJIoGBgOBVYiV1uYdpKj'
> STRIPE_PUBLIC_KEY = '********************'
> STRIPE_WEBHOOK_SECRET = '********************'
> TASKS = {'default': {'BACKEND': 
> 'django.tasks.backends.immediate.ImmediateBackend'}}
> TEMPLATES = [{'BACKEND': 
> 'django.template.backends.django.DjangoTemplates', 'DIRS': [], 
> 'APP_DIRS': True, 'OPTIONS': {'context_processors': 
> ['django.template.context_processors.debug', 
> 'django.template.context_processors.request', 
> 'django.contrib.auth.context_processors.auth', 
> 'django.contrib.messages.context_processors.messages']}}]
> TEST_NON_SERIALIZED_APPS = []
> TEST_RUNNER = 'django.test.runner.DiscoverRunner'
> THOUSAND_SEPARATOR = ','
> TIME_FORMAT = 'P'
> TIME_INPUT_FORMATS = ['%H:%M:%S', '%H:%M:%S.%f', '%H:%M']
> TIME_ZONE = 'UTC'
> TRANSLATE_API_TOKEN = '********************'
> TRANSLATE_API_URL = '********************'
> URLIZE_ASSUME_HTTPS = False
> USE_I18N = False
> USE_THOUSAND_SEPARATOR = False
> USE_TZ = False
> USE_X_FORWARDED_HOST = False
> USE_X_FORWARDED_PORT = False
> WSGI_APPLICATION = 'mataroa.wsgi.application'
> X_FRAME_OPTIONS = 'DENY'
> YEAR_MONTH_FORMAT = 'F Y'

